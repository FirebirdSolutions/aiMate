@using Fluxor
@using AiMate.Web.Store.Settings
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<SettingsState> SettingsState
@inject IDispatcher Dispatcher

@* Mobile-first responsive Connections Settings Tab *@

<div class="space-y-6 md:space-y-8">

    @* Section: API Connections *@
    <div>
        <h3 class="text-base md:text-lg font-semibold text-white mb-2">API Connections</h3>
        <p class="text-sm text-gray-400 mb-4">Configure API endpoints and authentication</p>

        <div class="space-y-4">
            @* OpenAI API Key *@
            <div class="bg-[#0F0F0F] border border-[#2A2A2A] rounded-lg p-4">
                <label class="block text-sm font-medium text-white mb-2">OpenAI API Key</label>
                <div class="flex items-center gap-2">
                    <input type="@(showOpenAIKey ? "text" : "password")"
                           @bind="_openAIApiKey"
                           @bind:after="@(() => Dispatcher.Dispatch(new UpdateOpenAIKeyAction(_openAIApiKey)))"
                           class="flex-1 bg-[#1A1A1A] border border-[#2A2A2A] text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono"
                           placeholder="sk-..." />
                    <button @onclick="@(() => showOpenAIKey = !showOpenAIKey)"
                            class="p-2 text-gray-400 hover:text-white hover:bg-[#2A2A2A] rounded-lg transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            @if (showOpenAIKey)
                            {
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                <line x1="1" y1="1" x2="23" y2="23"/>
                            }
                            else
                            {
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            }
                        </svg>
                    </button>
                </div>
            </div>

            @* Anthropic API Key *@
            <div class="bg-[#0F0F0F] border border-[#2A2A2A] rounded-lg p-4">
                <label class="block text-sm font-medium text-white mb-2">Anthropic API Key</label>
                <div class="flex items-center gap-2">
                    <input type="@(showAnthropicKey ? "text" : "password")"
                           @bind="_anthropicApiKey"
                           @bind:after="@(() => Dispatcher.Dispatch(new UpdateAnthropicKeyAction(_anthropicApiKey)))"
                           class="flex-1 bg-[#1A1A1A] border border-[#2A2A2A] text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono"
                           placeholder="sk-ant-..." />
                    <button @onclick="@(() => showAnthropicKey = !showAnthropicKey)"
                            class="p-2 text-gray-400 hover:text-white hover:bg-[#2A2A2A] rounded-lg transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            @if (showAnthropicKey)
                            {
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                <line x1="1" y1="1" x2="23" y2="23"/>
                            }
                            else
                            {
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            }
                        </svg>
                    </button>
                </div>
            </div>

            @* Ollama Base URL *@
            <div class="bg-[#0F0F0F] border border-[#2A2A2A] rounded-lg p-4">
                <label class="block text-sm font-medium text-white mb-2">Ollama Base URL</label>
                <input type="text"
                       @bind="_ollamaUrl"
                       @bind:after="@(() => Dispatcher.Dispatch(new UpdateOllamaUrlAction(_ollamaUrl)))"
                       class="w-full bg-[#1A1A1A] border border-[#2A2A2A] text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                       placeholder="http://localhost:11434" />
            </div>
        </div>
    </div>

</div>

@code {
    private string _openAIApiKey = "";
    private string _anthropicApiKey = "";
    private string _ollamaUrl = "http://localhost:11434";

    private bool showOpenAIKey = false;
    private bool showAnthropicKey = false;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        _openAIApiKey = SettingsState.Value.OpenAIApiKey ?? "";
        _anthropicApiKey = SettingsState.Value.AnthropicApiKey ?? "";
        _ollamaUrl = SettingsState.Value.OllamaUrl ?? "http://localhost:11434";
    }
}
