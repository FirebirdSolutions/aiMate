@* Top bar with model selector and new chat button *@
@using Fluxor
@using AiMate.Web.Store.Chat
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<ChatState> ChatState
@inject IDispatcher Dispatcher
@inject NavigationManager Navigation

<MudAppBar Elevation="0" Dense="true" Style="background-color: #1A1A1A; border-bottom: 1px solid #2A2A2A;">
    <MudIconButton Icon="@Icons.Material.Filled.Menu"
                   Color="Color.Inherit"
                   Edge="Edge.Start"
                   Class="d-lg-none" />

    <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
        <MudMenu Icon="@Icons.Material.Filled.SmartToy"
                 Color="Color.Inherit"
                 AnchorOrigin="Origin.BottomLeft"
                 TransformOrigin="Origin.TopLeft">
            <ActivatorContent>
                <MudButton Color="Color.Inherit"
                          StartIcon="@Icons.Material.Filled.SmartToy"
                          EndIcon="@Icons.Material.Filled.KeyboardArrowDown"
                          Style="text-transform: none;">
                    @SelectedModel
                </MudButton>
            </ActivatorContent>
            <ChildContent>
                <MudMenuItem OnClick="@(() => SelectModel("GPT-4"))">GPT-4</MudMenuItem>
                <MudMenuItem OnClick="@(() => SelectModel("GPT-3.5 Turbo"))">GPT-3.5 Turbo</MudMenuItem>
                <MudDivider />
                <MudMenuItem OnClick="@(() => SelectModel("Claude 3.5 Sonnet"))">Claude 3.5 Sonnet</MudMenuItem>
                <MudMenuItem OnClick="@(() => SelectModel("Claude 3 Opus"))">Claude 3 Opus</MudMenuItem>
                <MudDivider />
                <MudMenuItem OnClick="@(() => SelectModel("Gemini Pro"))">Gemini Pro</MudMenuItem>
            </ChildContent>
        </MudMenu>
    </div>

    <MudSpacer />

    <div style="display: flex; align-items: center; gap: 12px;">
        <MudButton Variant="Variant.Outlined"
                  Color="Color.Primary"
                  StartIcon="@Icons.Material.Filled.Add"
                  OnClick="@OnNewChat"
                  Style="text-transform: none;">
            New Chat
        </MudButton>

        <MudIconButton Icon="@Icons.Material.Filled.MoreVert"
                       Color="Color.Inherit"
                       Edge="Edge.End" />
    </div>
</MudAppBar>

@code {
    private string SelectedModel => ChatState.Value.SelectedModel ?? "GPT-4";

    private void SelectModel(string model)
    {
        Dispatcher.Dispatch(new SelectModelAction(model));
    }

    private void OnNewChat()
    {
        var action = new CreateConversationAction("New Chat");
        Dispatcher.Dispatch(action);
        // Navigate to home to show the new conversation
        Navigation.NavigateTo("/");
    }
}
