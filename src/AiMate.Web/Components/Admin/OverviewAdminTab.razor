@using Fluxor
@using AiMate.Web.Store.Admin
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@inject IState<AdminState> AdminState

<div class="space-y-6">
    <h2 class="text-xl font-semibold text-gray-100">System Overview</h2>

    @* Quick Stats *@
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        @* Total Users *@
        <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
            <p class="text-xs text-gray-400 mb-1">Total Users</p>
            <p class="text-3xl font-bold text-gray-100 mb-2">@AdminState.Value.TotalUsers</p>
            <p class="text-xs text-blue-400">Single-user mode</p>
        </div>

        @* Total Conversations *@
        <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
            <p class="text-xs text-gray-400 mb-1">Total Conversations</p>
            <p class="text-3xl font-bold text-gray-100 mb-2">@AdminState.Value.TotalConversations</p>
            <div class="flex items-center gap-1 text-xs text-green-400">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"/>
                </svg>
                +@AdminState.Value.ConversationsToday today
            </div>
        </div>

        @* Active Models *@
        <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
            <p class="text-xs text-gray-400 mb-1">Active Models</p>
            <p class="text-3xl font-bold text-gray-100 mb-2">@AdminState.Value.ActiveModels</p>
            <p class="text-xs text-gray-400">@AdminState.Value.TotalModels configured</p>
        </div>

        @* MCP Servers *@
        <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
            <p class="text-xs text-gray-400 mb-1">MCP Servers</p>
            <p class="text-3xl font-bold text-gray-100 mb-2">@AdminState.Value.ConnectedMcpServers</p>
            <p class="text-xs @(AdminState.Value.ConnectedMcpServers > 0 ? "text-green-400" : "text-gray-400")">
                @(AdminState.Value.ConnectedMcpServers > 0 ? $"{AdminState.Value.ConnectedMcpServers} of {AdminState.Value.TotalMcpServers} connected" : "None configured")
            </p>
        </div>
    </div>

    @* System Health *@
    <div>
        <h3 class="text-lg font-semibold text-gray-100 mb-4">System Health</h3>

        <div class="bg-[#0F0F0F] border border-[#2A2A2A] rounded-xl overflow-hidden">
            <div class="divide-y divide-[#2A2A2A]">
                @* LiteLLM Proxy *@
                <div class="px-5 py-4 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-200">LiteLLM Proxy</span>
                    <div class="flex items-center gap-3">
                        <span class="px-2.5 py-1 rounded-full text-xs font-semibold @(AdminState.Value.LiteLLMConnected ? "bg-green-500/20 text-green-400 border border-green-500/50" : "bg-red-500/20 text-red-400 border border-red-500/50")">
                            @(AdminState.Value.LiteLLMConnected ? "Connected" : "Disconnected")
                        </span>
                        <span class="text-sm text-gray-400">@AdminState.Value.LiteLLMUrl</span>
                    </div>
                </div>

                @* Storage *@
                <div class="px-5 py-4 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-200">Storage</span>
                    <div class="flex items-center gap-3">
                        <span class="px-2.5 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/50 rounded-full text-xs font-semibold">
                            @AdminState.Value.StorageUsedMB.ToString("F1") / @AdminState.Value.StorageLimitMB.ToString("F1") MB
                        </span>
                        <span class="text-sm text-gray-400">@((AdminState.Value.StorageUsedMB / AdminState.Value.StorageLimitMB * 100).ToString("F1"))% used</span>
                    </div>
                </div>

                @* App Version *@
                <div class="px-5 py-4 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-200">App Version</span>
                    <div class="flex items-center gap-3">
                        <span class="px-2.5 py-1 bg-[#1A1A1A] border border-[#2A2A2A] rounded-full text-xs font-medium text-gray-300">
                            @AdminState.Value.AppVersion
                        </span>
                        <span class="text-sm text-gray-400">Blazor Server â€¢ .NET 9</span>
                    </div>
                </div>

                @* Uptime *@
                <div class="px-5 py-4 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-200">Uptime</span>
                    <div class="flex items-center gap-3">
                        <span class="text-sm text-gray-300">@AdminState.Value.Uptime</span>
                        <span class="text-sm text-gray-400">Since @DateTime.Now.AddHours(-2).ToString("HH:mm")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Storage Details *@
    <div>
        <h3 class="text-lg font-semibold text-gray-100 mb-4">Storage</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @* LocalStorage *@
            <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
                <h4 class="text-sm font-semibold text-gray-200 mb-3">LocalStorage</h4>
                <div class="relative w-full h-2 bg-[#0F0F0F] rounded-full overflow-hidden mb-2">
                    <div class="absolute top-0 left-0 h-full bg-purple-600 rounded-full transition-all"
                         style="width: @((AdminState.Value.LocalStorageUsedMB / AdminState.Value.LocalStorageLimitMB) * 100)%"></div>
                </div>
                <p class="text-sm text-gray-300">
                    @AdminState.Value.LocalStorageUsedMB.ToString("F1") MB / @AdminState.Value.LocalStorageLimitMB.ToString("F1") MB
                </p>
            </div>

            @* IndexedDB *@
            <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl p-5">
                <h4 class="text-sm font-semibold text-gray-200 mb-3">IndexedDB</h4>
                <div class="relative w-full h-2 bg-[#0F0F0F] rounded-full overflow-hidden mb-2">
                    <div class="absolute top-0 left-0 h-full bg-blue-600 rounded-full transition-all"
                         style="width: @((AdminState.Value.IndexedDBUsedMB / AdminState.Value.IndexedDBLimitMB) * 100)%"></div>
                </div>
                <p class="text-sm text-gray-300">
                    @AdminState.Value.IndexedDBUsedMB.ToString("F1") MB / @AdminState.Value.IndexedDBLimitMB.ToString("F1") MB
                </p>
            </div>
        </div>
    </div>
</div>
