@inject IJSRuntime JSRuntime

@if (IsOpen)
{
    @* Modal Overlay *@
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
         @onclick="HandleOverlayClick">

        @* Modal Dialog *@
        <div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"
             @onclick:stopPropagation="true">

            @* Header *@
            <div class="flex items-center justify-between px-6 py-4 border-b border-[#2A2A2A]">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-white">Admin Panel</h2>
                        <p class="text-sm text-gray-400">Administrator settings and configurations</p>
                    </div>
                </div>
                <button @onclick="Close"
                        class="p-2 text-gray-400 hover:text-white hover:bg-[#2A2A2A] rounded-lg transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            @* Horizontal Tab Navigation *@
            <div class="border-b border-[#2A2A2A] overflow-x-auto scrollbar-thin scrollbar-thumb-[#2A2A2A] scrollbar-track-transparent">
                <div class="flex px-6 min-w-max">
                    @foreach (var tab in tabs)
                    {
                        <button @onclick="@(() => SelectTab(tab.Id))"
                                class="flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-all whitespace-nowrap
                                       @(activeTab == tab.Id ? "border-purple-500 text-white" : "border-transparent text-gray-400 hover:text-white hover:bg-[#2A2A2A]/50")">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                @((MarkupString)tab.Icon)
                            </svg>
                            <span>@tab.Name</span>
                        </button>
                    }
                </div>
            </div>

            @* Tab Content *@
            <div class="flex-1 overflow-y-auto p-6">
                @switch (activeTab)
                {
                    case "general":
                        <GeneralAdminTab />
                        break;
                    case "interface":
                        <InterfaceAdminTab />
                        break;
                    case "users":
                        <UsersAdminTab />
                        break;
                    case "connections":
                        <ConnectionsAdminTab />
                        break;
                    case "models":
                        <ModelsAdminTab />
                        break;
                    case "plugins":
                        <PluginsAdminTab />
                        break;
                    case "mcp":
                        <McpAdminTab />
                        break;
                    case "documents":
                        <DocumentsAdminTab />
                        break;
                    case "websearch":
                        <WebSearchAdminTab />
                        break;
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private string activeTab = "general";

    private List<TabInfo> tabs = new()
    {
        new TabInfo { Id = "general", Name = "General", Icon = "<circle cx=\"12\" cy=\"12\" r=\"3\"/><path d=\"M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24\"/>" },
        new TabInfo { Id = "interface", Name = "Interface", Icon = "<rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/><line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"/><line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"/>" },
        new TabInfo { Id = "users", Name = "Users & Groups", Icon = "<path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M23 21v-2a4 4 0 0 0-3-3.87m-4-12a4 4 0 0 1 0 7.75\"/>" },
        new TabInfo { Id = "connections", Name = "Connections", Icon = "<path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"/><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"/>" },
        new TabInfo { Id = "models", Name = "Models", Icon = "<path d=\"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z\"/>" },
        new TabInfo { Id = "plugins", Name = "Plugins", Icon = "<rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><path d=\"M3 9h18M9 21V9\"/>" },
        new TabInfo { Id = "mcp", Name = "MCP", Icon = "<path d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"/><polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"/><line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"/>" },
        new TabInfo { Id = "documents", Name = "Documents", Icon = "<path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/><polyline points=\"14 2 14 8 20 8\"/><line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"/><line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"/><polyline points=\"10 9 9 9 8 9\"/>" },
        new TabInfo { Id = "websearch", Name = "Web Search", Icon = "<circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>" }
    };

    private void SelectTab(string tabId)
    {
        activeTab = tabId;
    }

    private async Task HandleOverlayClick()
    {
        await Close();
    }

    private async Task Close()
    {
        await OnClose.InvokeAsync();
    }

    public class TabInfo
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
    }
}
