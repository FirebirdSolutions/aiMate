@using System.Text.Json

<div class="bg-[#1A1A1A] border border-[#2A2A2A] rounded-lg overflow-hidden">
    @if (Data?.Type == "table")
    {
        <StructuredTable Data="Data" />
    }
    else if (Data?.Type == "form")
    {
        <StructuredForm Data="Data" />
    }
    else if (Data?.Type == "list")
    {
        <StructuredList Data="Data" />
    }
    else if (Data?.Type == "card")
    {
        <StructuredCard Data="Data" />
    }
</div>

@code {
    [Parameter] public StructuredData? Data { get; set; }
}

@* Table Component *@
@code {
    private RenderFragment StructuredTable(StructuredData data) => __builder =>
    {
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-[#242424] border-b border-[#2A2A2A]">
                    <tr>
                        @if (data.Columns != null)
                        {
                            @foreach (var column in data.Columns)
                            {
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">
                                    @column
                                </th>
                            }
                        }
                    </tr>
                </thead>
                <tbody class="divide-y divide-[#2A2A2A]">
                    @if (data.Rows != null)
                    {
                        @foreach (var row in data.Rows)
                        {
                            <tr class="hover:bg-[#242424] transition-colors">
                                @foreach (var cell in row)
                                {
                                    <td class="px-4 py-3 text-gray-300">@cell</td>
                                }
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        @* Pagination *@
        @if (data.TotalPages > 1)
        {
            <div class="flex items-center justify-between px-4 py-3 border-t border-[#2A2A2A] text-sm">
                <div class="text-gray-400">
                    Showing @data.CurrentPage of @data.TotalPages pages
                </div>
                <div class="flex gap-2">
                    <button class="px-3 py-1 bg-[#242424] hover:bg-[#2A2A2A] text-gray-300 rounded transition-all disabled:opacity-50"
                            disabled="@(data.CurrentPage <= 1)">
                        Previous
                    </button>
                    <button class="px-3 py-1 bg-[#242424] hover:bg-[#2A2A2A] text-gray-300 rounded transition-all disabled:opacity-50"
                            disabled="@(data.CurrentPage >= data.TotalPages)">
                        Next
                    </button>
                </div>
            </div>
        }
    };

    private RenderFragment StructuredForm(StructuredData data) => __builder =>
    {
        <div class="p-6 space-y-4">
            <h3 class="text-lg font-semibold text-white mb-4">@data.Title</h3>
            @if (data.Fields != null)
            {
                @foreach (var field in data.Fields)
                {
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">@field.Label</label>
                        @if (field.Type == "textarea")
                        {
                            <textarea class="w-full px-3 py-2 bg-[#242424] border border-[#2A2A2A] rounded-lg text-white resize-none focus:outline-none focus:ring-2 focus:ring-purple-500"
                                      rows="3"
                                      placeholder="@field.Placeholder"></textarea>
                        }
                        else if (field.Type == "select")
                        {
                            <select class="w-full px-3 py-2 bg-[#242424] border border-[#2A2A2A] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option>@field.Placeholder</option>
                            </select>
                        }
                        else
                        {
                            <input type="@field.Type"
                                   class="w-full px-3 py-2 bg-[#242424] border border-[#2A2A2A] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                   placeholder="@field.Placeholder" />
                        }
                    </div>
                }
            }
            <div class="flex gap-2 pt-4">
                <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all">
                    Submit
                </button>
                <button class="px-4 py-2 bg-[#242424] hover:bg-[#2A2A2A] text-gray-300 rounded-lg transition-all">
                    Cancel
                </button>
            </div>
        </div>
    };

    private RenderFragment StructuredList(StructuredData data) => __builder =>
    {
        <div class="p-4">
            @if (!string.IsNullOrEmpty(data.Title))
            {
                <h3 class="text-lg font-semibold text-white mb-3 px-2">@data.Title</h3>
            }
            <ul class="space-y-2">
                @if (data.Items != null)
                {
                    @foreach (var item in data.Items)
                    {
                        <li class="flex items-start gap-3 px-2 py-2 hover:bg-[#242424] rounded-lg transition-colors">
                            <div class="flex-shrink-0 w-6 h-6 rounded-full bg-purple-500/10 flex items-center justify-center mt-0.5">
                                <svg class="w-3 h-3 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                            <span class="text-gray-300 flex-1">@item</span>
                        </li>
                    }
                }
            </ul>
        </div>
    };

    private RenderFragment StructuredCard(StructuredData data) => __builder =>
    {
        <div class="p-6">
            @if (!string.IsNullOrEmpty(data.Title))
            {
                <h3 class="text-lg font-semibold text-white mb-2">@data.Title</h3>
            }
            @if (!string.IsNullOrEmpty(data.Description))
            {
                <p class="text-gray-400 mb-4">@data.Description</p>
            }
            @if (data.Items != null)
            {
                <div class="space-y-3">
                    @foreach (var item in data.Items)
                    {
                        <div class="flex items-center justify-between py-2 border-b border-[#2A2A2A] last:border-0">
                            <span class="text-gray-300">@item</span>
                        </div>
                    }
                </div>
            }
        </div>
    };
}

@* Data Models *@
@code {
    public class StructuredData
    {
        public string Type { get; set; } = "table"; // table, form, list, card
        public string? Title { get; set; }
        public string? Description { get; set; }

        // Table-specific
        public List<string>? Columns { get; set; }
        public List<List<string>>? Rows { get; set; }
        public int CurrentPage { get; set; } = 1;
        public int TotalPages { get; set; } = 1;

        // Form-specific
        public List<FormField>? Fields { get; set; }

        // List/Card-specific
        public List<string>? Items { get; set; }
    }

    public class FormField
    {
        public string Label { get; set; } = string.Empty;
        public string Type { get; set; } = "text"; // text, textarea, select, etc.
        public string Placeholder { get; set; } = string.Empty;
        public bool Required { get; set; }
    }
}
